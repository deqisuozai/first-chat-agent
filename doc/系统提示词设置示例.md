# 系统提示词设置示例

## 📝 基本使用方法

### 1. 在 Chat 类中设置提示词

```typescript
// 在 Chat 类的构造函数或初始化方法中
const chatAgent = new Chat(state, env);

// 方法1：使用预设配置
chatAgent.usePromptPreset('technical');  // 技术助手
chatAgent.usePromptPreset('customerService');  // 客服助手
chatAgent.usePromptPreset('education');  // 教育助手

// 方法2：自定义配置
chatAgent.setPromptConfig({
  language: 'zh',
  personality: 'friendly',
  domain: 'customer-service',
  features: ['支持多轮对话', '情感理解']
});

// 方法3：添加特殊功能
chatAgent.addPromptFeature('支持代码生成');
chatAgent.addPromptFeature('可以解释技术概念');
```

### 2. 预设配置说明

```typescript
// 通用友好助手（默认）
PRESET_CONFIGS.general
// 生成：友好、耐心的通用AI助手

// 专业客服助手
PRESET_CONFIGS.customerService
// 生成：专业、以客户为中心的服务助手

// 技术专家助手
PRESET_CONFIGS.technical
// 生成：技术精准、提供代码示例的开发助手

// 教育助手
PRESET_CONFIGS.education
// 生成：善于解释、提供学习指导的教育助手

// 英文助手
PRESET_CONFIGS.english
// 生成：英文交流的专业助手
```

## 🎯 具体应用场景

### 场景1：客服聊天机器人

```typescript
export class CustomerServiceChat extends Chat {
  constructor(state: DurableObjectState, env: Env) {
    super(state, env);
    
    // 设置为客服模式
    this.usePromptPreset('customerService');
    
    // 添加客服特定功能
    this.addPromptFeature('可以查询订单状态');
    this.addPromptFeature('可以处理退款申请');
    this.addPromptFeature('提供7x24小时服务');
  }
}
```

生成的系统提示词：
```
你是一个专业的AI助手。

🎯 **核心能力**：
- 提供准确、专业的信息和建议
- 协助用户解决复杂问题
- 支持多语言交流
- 具备广泛的专业知识

🛠️ **工具使用**：
- 可以调用各种工具来完成复杂任务
- 在使用需要确认的工具前会先征求用户同意
- 能够安排和管理定时任务

🏢 **专业领域**：
你专注于客户服务，始终以客户满意为目标，耐心解决客户问题。
专业工具：订单查询、问题反馈、服务评价

📝 **交互风格**：
- 专业、准确、高效
- 回答结构清晰，逻辑严密
- 在不确定时会明确说明
- 提供详细的解决方案

✨ **特殊功能**：
- 可以查询订单状态
- 可以处理退款申请
- 提供7x24小时服务

如果用户要求安排任务，请使用 schedule 工具来安排任务。
```

### 场景2：技术支持助手

```typescript
export class TechnicalSupportChat extends Chat {
  constructor(state: DurableObjectState, env: Env) {
    super(state, env);
    
    // 设置为技术模式
    this.setPromptConfig({
      language: 'zh',
      personality: 'technical',
      domain: 'development',
      features: [
        '精通多种编程语言',
        '可以进行代码审查',
        '提供架构建议',
        '解决性能问题'
      ]
    });
  }
}
```

### 场景3：教育助手

```typescript
export class EducationChat extends Chat {
  constructor(state: DurableObjectState, env: Env) {
    super(state, env);
    
    this.usePromptPreset('education');
    this.addPromptFeature('可以生成练习题');
    this.addPromptFeature('提供学习计划');
    this.addPromptFeature('支持多种学科');
  }
}
```

### 场景4：多语言支持

```typescript
export class MultiLanguageChat extends Chat {
  private currentLanguage: 'zh' | 'en' = 'zh';
  
  switchLanguage(language: 'zh' | 'en') {
    this.currentLanguage = language;
    this.setPromptConfig({
      language: language,
      personality: 'friendly'
    });
  }
  
  // 可以根据用户输入自动检测语言
  async detectAndSwitchLanguage(userMessage: string) {
    const isEnglish = /^[a-zA-Z\s\d\.,!?'"()-]+$/.test(userMessage);
    if (isEnglish && this.currentLanguage === 'zh') {
      this.switchLanguage('en');
    } else if (!isEnglish && this.currentLanguage === 'en') {
      this.switchLanguage('zh');
    }
  }
}
```

## 🔧 动态提示词管理

### 1. 运行时修改提示词

```typescript
// 在聊天过程中动态调整
export class AdaptiveChat extends Chat {
  async onChatMessage(onFinish: StreamTextOnFinishCallback<ToolSet>) {
    // 根据对话内容调整提示词
    const lastMessage = this.messages[this.messages.length - 1];
    
    if (lastMessage?.content.includes('技术') || lastMessage?.content.includes('代码')) {
      this.usePromptPreset('technical');
    } else if (lastMessage?.content.includes('学习') || lastMessage?.content.includes('教学')) {
      this.usePromptPreset('education');
    }
    
    return super.onChatMessage(onFinish);
  }
}
```

### 2. 基于用户角色的提示词

```typescript
export class RoleBasedChat extends Chat {
  setUserRole(role: 'student' | 'developer' | 'customer' | 'manager') {
    switch (role) {
      case 'student':
        this.usePromptPreset('education');
        this.addPromptFeature('使用简单易懂的语言');
        break;
      case 'developer':
        this.usePromptPreset('technical');
        this.addPromptFeature('提供详细的技术文档');
        break;
      case 'customer':
        this.usePromptPreset('customerService');
        this.addPromptFeature('优先解决客户问题');
        break;
      case 'manager':
        this.setPromptConfig({
          language: 'zh',
          personality: 'professional',
          features: ['提供数据分析', '生成报告摘要']
        });
        break;
    }
  }
}
```

## 🎨 自定义提示词模板

### 1. 创建自定义配置

```typescript
// 扩展预设配置
export const CUSTOM_PRESETS = {
  ...PRESET_CONFIGS,
  
  // 医疗助手
  medical: {
    language: 'zh' as const,
    personality: 'professional' as const,
    features: [
      '具备医学知识背景',
      '提供健康建议',
      '但不能替代专业医疗诊断',
      '会建议用户咨询专业医生'
    ]
  },
  
  // 法律助手
  legal: {
    language: 'zh' as const,
    personality: 'professional' as const,
    features: [
      '了解基本法律常识',
      '提供法律信息参考',
      '强调需要专业律师咨询',
      '保持中立和客观'
    ]
  },
  
  // 创意写作助手
  creative: {
    language: 'zh' as const,
    personality: 'casual' as const,
    features: [
      '擅长创意写作',
      '可以协助故事创作',
      '提供写作技巧',
      '激发创意灵感'
    ]
  }
};
```

### 2. 使用自定义配置

```typescript
export class CustomChat extends Chat {
  constructor(state: DurableObjectState, env: Env) {
    super(state, env);
    
    // 使用自定义配置
    this.setPromptConfig(CUSTOM_PRESETS.medical);
  }
}
```

## 📊 最佳实践

### 1. 提示词版本管理

```typescript
export class VersionedPromptChat extends Chat {
  private promptVersion: string = 'v1.0';
  
  updatePromptVersion(version: string) {
    this.promptVersion = version;
    // 可以根据版本加载不同的提示词配置
    console.log(`Updated prompt to version ${version}`);
  }
  
  getPromptMetadata() {
    return {
      version: this.promptVersion,
      config: this.promptManager.getSystemPrompt(),
      timestamp: new Date().toISOString()
    };
  }
}
```

### 2. A/B 测试支持

```typescript
export class ABTestChat extends Chat {
  constructor(state: DurableObjectState, env: Env) {
    super(state, env);
    
    // 随机选择提示词变体进行A/B测试
    const variants = ['friendly', 'professional', 'casual'];
    const randomVariant = variants[Math.floor(Math.random() * variants.length)];
    
    this.setPromptConfig({
      language: 'zh',
      personality: randomVariant as any
    });
    
    console.log(`Using prompt variant: ${randomVariant}`);
  }
}
```

### 3. 提示词性能监控

```typescript
export class MonitoredChat extends Chat {
  async onChatMessage(onFinish: StreamTextOnFinishCallback<ToolSet>) {
    const startTime = Date.now();
    const promptConfig = this.promptManager.getSystemPrompt();
    
    const result = await super.onChatMessage((event) => {
      const endTime = Date.now();
      const duration = endTime - startTime;
      
      // 记录性能指标
      console.log('Chat Performance:', {
        duration,
        promptLength: promptConfig.length,
        messageCount: this.messages.length,
        finishReason: event.finishReason
      });
      
      onFinish(event);
    });
    
    return result;
  }
}
```

## 🚀 部署建议

1. **环境变量配置**：可以通过环境变量控制默认提示词配置
2. **配置热更新**：支持在不重启服务的情况下更新提示词
3. **多租户支持**：不同的客户可以使用不同的提示词配置
4. **缓存优化**：对生成的提示词进行缓存以提高性能

这个系统提示词管理方案提供了极大的灵活性，可以根据不同的应用场景和用户需求动态调整AI助手的行为和风格！
