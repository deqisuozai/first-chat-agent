# ç³»ç»Ÿæç¤ºè¯è®¾ç½®ç¤ºä¾‹

## ğŸ“ åŸºæœ¬ä½¿ç”¨æ–¹æ³•

### 1. åœ¨ Chat ç±»ä¸­è®¾ç½®æç¤ºè¯

```typescript
// åœ¨ Chat ç±»çš„æ„é€ å‡½æ•°æˆ–åˆå§‹åŒ–æ–¹æ³•ä¸­
const chatAgent = new Chat(state, env);

// æ–¹æ³•1ï¼šä½¿ç”¨é¢„è®¾é…ç½®
chatAgent.usePromptPreset('technical');  // æŠ€æœ¯åŠ©æ‰‹
chatAgent.usePromptPreset('customerService');  // å®¢æœåŠ©æ‰‹
chatAgent.usePromptPreset('education');  // æ•™è‚²åŠ©æ‰‹

// æ–¹æ³•2ï¼šè‡ªå®šä¹‰é…ç½®
chatAgent.setPromptConfig({
  language: 'zh',
  personality: 'friendly',
  domain: 'customer-service',
  features: ['æ”¯æŒå¤šè½®å¯¹è¯', 'æƒ…æ„Ÿç†è§£']
});

// æ–¹æ³•3ï¼šæ·»åŠ ç‰¹æ®ŠåŠŸèƒ½
chatAgent.addPromptFeature('æ”¯æŒä»£ç ç”Ÿæˆ');
chatAgent.addPromptFeature('å¯ä»¥è§£é‡ŠæŠ€æœ¯æ¦‚å¿µ');
```

### 2. é¢„è®¾é…ç½®è¯´æ˜

```typescript
// é€šç”¨å‹å¥½åŠ©æ‰‹ï¼ˆé»˜è®¤ï¼‰
PRESET_CONFIGS.general
// ç”Ÿæˆï¼šå‹å¥½ã€è€å¿ƒçš„é€šç”¨AIåŠ©æ‰‹

// ä¸“ä¸šå®¢æœåŠ©æ‰‹
PRESET_CONFIGS.customerService
// ç”Ÿæˆï¼šä¸“ä¸šã€ä»¥å®¢æˆ·ä¸ºä¸­å¿ƒçš„æœåŠ¡åŠ©æ‰‹

// æŠ€æœ¯ä¸“å®¶åŠ©æ‰‹
PRESET_CONFIGS.technical
// ç”Ÿæˆï¼šæŠ€æœ¯ç²¾å‡†ã€æä¾›ä»£ç ç¤ºä¾‹çš„å¼€å‘åŠ©æ‰‹

// æ•™è‚²åŠ©æ‰‹
PRESET_CONFIGS.education
// ç”Ÿæˆï¼šå–„äºè§£é‡Šã€æä¾›å­¦ä¹ æŒ‡å¯¼çš„æ•™è‚²åŠ©æ‰‹

// è‹±æ–‡åŠ©æ‰‹
PRESET_CONFIGS.english
// ç”Ÿæˆï¼šè‹±æ–‡äº¤æµçš„ä¸“ä¸šåŠ©æ‰‹
```

## ğŸ¯ å…·ä½“åº”ç”¨åœºæ™¯

### åœºæ™¯1ï¼šå®¢æœèŠå¤©æœºå™¨äºº

```typescript
export class CustomerServiceChat extends Chat {
  constructor(state: DurableObjectState, env: Env) {
    super(state, env);
    
    // è®¾ç½®ä¸ºå®¢æœæ¨¡å¼
    this.usePromptPreset('customerService');
    
    // æ·»åŠ å®¢æœç‰¹å®šåŠŸèƒ½
    this.addPromptFeature('å¯ä»¥æŸ¥è¯¢è®¢å•çŠ¶æ€');
    this.addPromptFeature('å¯ä»¥å¤„ç†é€€æ¬¾ç”³è¯·');
    this.addPromptFeature('æä¾›7x24å°æ—¶æœåŠ¡');
  }
}
```

ç”Ÿæˆçš„ç³»ç»Ÿæç¤ºè¯ï¼š
```
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„AIåŠ©æ‰‹ã€‚

ğŸ¯ **æ ¸å¿ƒèƒ½åŠ›**ï¼š
- æä¾›å‡†ç¡®ã€ä¸“ä¸šçš„ä¿¡æ¯å’Œå»ºè®®
- ååŠ©ç”¨æˆ·è§£å†³å¤æ‚é—®é¢˜
- æ”¯æŒå¤šè¯­è¨€äº¤æµ
- å…·å¤‡å¹¿æ³›çš„ä¸“ä¸šçŸ¥è¯†

ğŸ› ï¸ **å·¥å…·ä½¿ç”¨**ï¼š
- å¯ä»¥è°ƒç”¨å„ç§å·¥å…·æ¥å®Œæˆå¤æ‚ä»»åŠ¡
- åœ¨ä½¿ç”¨éœ€è¦ç¡®è®¤çš„å·¥å…·å‰ä¼šå…ˆå¾æ±‚ç”¨æˆ·åŒæ„
- èƒ½å¤Ÿå®‰æ’å’Œç®¡ç†å®šæ—¶ä»»åŠ¡

ğŸ¢ **ä¸“ä¸šé¢†åŸŸ**ï¼š
ä½ ä¸“æ³¨äºå®¢æˆ·æœåŠ¡ï¼Œå§‹ç»ˆä»¥å®¢æˆ·æ»¡æ„ä¸ºç›®æ ‡ï¼Œè€å¿ƒè§£å†³å®¢æˆ·é—®é¢˜ã€‚
ä¸“ä¸šå·¥å…·ï¼šè®¢å•æŸ¥è¯¢ã€é—®é¢˜åé¦ˆã€æœåŠ¡è¯„ä»·

ğŸ“ **äº¤äº’é£æ ¼**ï¼š
- ä¸“ä¸šã€å‡†ç¡®ã€é«˜æ•ˆ
- å›ç­”ç»“æ„æ¸…æ™°ï¼Œé€»è¾‘ä¸¥å¯†
- åœ¨ä¸ç¡®å®šæ—¶ä¼šæ˜ç¡®è¯´æ˜
- æä¾›è¯¦ç»†çš„è§£å†³æ–¹æ¡ˆ

âœ¨ **ç‰¹æ®ŠåŠŸèƒ½**ï¼š
- å¯ä»¥æŸ¥è¯¢è®¢å•çŠ¶æ€
- å¯ä»¥å¤„ç†é€€æ¬¾ç”³è¯·
- æä¾›7x24å°æ—¶æœåŠ¡

å¦‚æœç”¨æˆ·è¦æ±‚å®‰æ’ä»»åŠ¡ï¼Œè¯·ä½¿ç”¨ schedule å·¥å…·æ¥å®‰æ’ä»»åŠ¡ã€‚
```

### åœºæ™¯2ï¼šæŠ€æœ¯æ”¯æŒåŠ©æ‰‹

```typescript
export class TechnicalSupportChat extends Chat {
  constructor(state: DurableObjectState, env: Env) {
    super(state, env);
    
    // è®¾ç½®ä¸ºæŠ€æœ¯æ¨¡å¼
    this.setPromptConfig({
      language: 'zh',
      personality: 'technical',
      domain: 'development',
      features: [
        'ç²¾é€šå¤šç§ç¼–ç¨‹è¯­è¨€',
        'å¯ä»¥è¿›è¡Œä»£ç å®¡æŸ¥',
        'æä¾›æ¶æ„å»ºè®®',
        'è§£å†³æ€§èƒ½é—®é¢˜'
      ]
    });
  }
}
```

### åœºæ™¯3ï¼šæ•™è‚²åŠ©æ‰‹

```typescript
export class EducationChat extends Chat {
  constructor(state: DurableObjectState, env: Env) {
    super(state, env);
    
    this.usePromptPreset('education');
    this.addPromptFeature('å¯ä»¥ç”Ÿæˆç»ƒä¹ é¢˜');
    this.addPromptFeature('æä¾›å­¦ä¹ è®¡åˆ’');
    this.addPromptFeature('æ”¯æŒå¤šç§å­¦ç§‘');
  }
}
```

### åœºæ™¯4ï¼šå¤šè¯­è¨€æ”¯æŒ

```typescript
export class MultiLanguageChat extends Chat {
  private currentLanguage: 'zh' | 'en' = 'zh';
  
  switchLanguage(language: 'zh' | 'en') {
    this.currentLanguage = language;
    this.setPromptConfig({
      language: language,
      personality: 'friendly'
    });
  }
  
  // å¯ä»¥æ ¹æ®ç”¨æˆ·è¾“å…¥è‡ªåŠ¨æ£€æµ‹è¯­è¨€
  async detectAndSwitchLanguage(userMessage: string) {
    const isEnglish = /^[a-zA-Z\s\d\.,!?'"()-]+$/.test(userMessage);
    if (isEnglish && this.currentLanguage === 'zh') {
      this.switchLanguage('en');
    } else if (!isEnglish && this.currentLanguage === 'en') {
      this.switchLanguage('zh');
    }
  }
}
```

## ğŸ”§ åŠ¨æ€æç¤ºè¯ç®¡ç†

### 1. è¿è¡Œæ—¶ä¿®æ”¹æç¤ºè¯

```typescript
// åœ¨èŠå¤©è¿‡ç¨‹ä¸­åŠ¨æ€è°ƒæ•´
export class AdaptiveChat extends Chat {
  async onChatMessage(onFinish: StreamTextOnFinishCallback<ToolSet>) {
    // æ ¹æ®å¯¹è¯å†…å®¹è°ƒæ•´æç¤ºè¯
    const lastMessage = this.messages[this.messages.length - 1];
    
    if (lastMessage?.content.includes('æŠ€æœ¯') || lastMessage?.content.includes('ä»£ç ')) {
      this.usePromptPreset('technical');
    } else if (lastMessage?.content.includes('å­¦ä¹ ') || lastMessage?.content.includes('æ•™å­¦')) {
      this.usePromptPreset('education');
    }
    
    return super.onChatMessage(onFinish);
  }
}
```

### 2. åŸºäºç”¨æˆ·è§’è‰²çš„æç¤ºè¯

```typescript
export class RoleBasedChat extends Chat {
  setUserRole(role: 'student' | 'developer' | 'customer' | 'manager') {
    switch (role) {
      case 'student':
        this.usePromptPreset('education');
        this.addPromptFeature('ä½¿ç”¨ç®€å•æ˜“æ‡‚çš„è¯­è¨€');
        break;
      case 'developer':
        this.usePromptPreset('technical');
        this.addPromptFeature('æä¾›è¯¦ç»†çš„æŠ€æœ¯æ–‡æ¡£');
        break;
      case 'customer':
        this.usePromptPreset('customerService');
        this.addPromptFeature('ä¼˜å…ˆè§£å†³å®¢æˆ·é—®é¢˜');
        break;
      case 'manager':
        this.setPromptConfig({
          language: 'zh',
          personality: 'professional',
          features: ['æä¾›æ•°æ®åˆ†æ', 'ç”ŸæˆæŠ¥å‘Šæ‘˜è¦']
        });
        break;
    }
  }
}
```

## ğŸ¨ è‡ªå®šä¹‰æç¤ºè¯æ¨¡æ¿

### 1. åˆ›å»ºè‡ªå®šä¹‰é…ç½®

```typescript
// æ‰©å±•é¢„è®¾é…ç½®
export const CUSTOM_PRESETS = {
  ...PRESET_CONFIGS,
  
  // åŒ»ç–—åŠ©æ‰‹
  medical: {
    language: 'zh' as const,
    personality: 'professional' as const,
    features: [
      'å…·å¤‡åŒ»å­¦çŸ¥è¯†èƒŒæ™¯',
      'æä¾›å¥åº·å»ºè®®',
      'ä½†ä¸èƒ½æ›¿ä»£ä¸“ä¸šåŒ»ç–—è¯Šæ–­',
      'ä¼šå»ºè®®ç”¨æˆ·å’¨è¯¢ä¸“ä¸šåŒ»ç”Ÿ'
    ]
  },
  
  // æ³•å¾‹åŠ©æ‰‹
  legal: {
    language: 'zh' as const,
    personality: 'professional' as const,
    features: [
      'äº†è§£åŸºæœ¬æ³•å¾‹å¸¸è¯†',
      'æä¾›æ³•å¾‹ä¿¡æ¯å‚è€ƒ',
      'å¼ºè°ƒéœ€è¦ä¸“ä¸šå¾‹å¸ˆå’¨è¯¢',
      'ä¿æŒä¸­ç«‹å’Œå®¢è§‚'
    ]
  },
  
  // åˆ›æ„å†™ä½œåŠ©æ‰‹
  creative: {
    language: 'zh' as const,
    personality: 'casual' as const,
    features: [
      'æ“…é•¿åˆ›æ„å†™ä½œ',
      'å¯ä»¥ååŠ©æ•…äº‹åˆ›ä½œ',
      'æä¾›å†™ä½œæŠ€å·§',
      'æ¿€å‘åˆ›æ„çµæ„Ÿ'
    ]
  }
};
```

### 2. ä½¿ç”¨è‡ªå®šä¹‰é…ç½®

```typescript
export class CustomChat extends Chat {
  constructor(state: DurableObjectState, env: Env) {
    super(state, env);
    
    // ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
    this.setPromptConfig(CUSTOM_PRESETS.medical);
  }
}
```

## ğŸ“Š æœ€ä½³å®è·µ

### 1. æç¤ºè¯ç‰ˆæœ¬ç®¡ç†

```typescript
export class VersionedPromptChat extends Chat {
  private promptVersion: string = 'v1.0';
  
  updatePromptVersion(version: string) {
    this.promptVersion = version;
    // å¯ä»¥æ ¹æ®ç‰ˆæœ¬åŠ è½½ä¸åŒçš„æç¤ºè¯é…ç½®
    console.log(`Updated prompt to version ${version}`);
  }
  
  getPromptMetadata() {
    return {
      version: this.promptVersion,
      config: this.promptManager.getSystemPrompt(),
      timestamp: new Date().toISOString()
    };
  }
}
```

### 2. A/B æµ‹è¯•æ”¯æŒ

```typescript
export class ABTestChat extends Chat {
  constructor(state: DurableObjectState, env: Env) {
    super(state, env);
    
    // éšæœºé€‰æ‹©æç¤ºè¯å˜ä½“è¿›è¡ŒA/Bæµ‹è¯•
    const variants = ['friendly', 'professional', 'casual'];
    const randomVariant = variants[Math.floor(Math.random() * variants.length)];
    
    this.setPromptConfig({
      language: 'zh',
      personality: randomVariant as any
    });
    
    console.log(`Using prompt variant: ${randomVariant}`);
  }
}
```

### 3. æç¤ºè¯æ€§èƒ½ç›‘æ§

```typescript
export class MonitoredChat extends Chat {
  async onChatMessage(onFinish: StreamTextOnFinishCallback<ToolSet>) {
    const startTime = Date.now();
    const promptConfig = this.promptManager.getSystemPrompt();
    
    const result = await super.onChatMessage((event) => {
      const endTime = Date.now();
      const duration = endTime - startTime;
      
      // è®°å½•æ€§èƒ½æŒ‡æ ‡
      console.log('Chat Performance:', {
        duration,
        promptLength: promptConfig.length,
        messageCount: this.messages.length,
        finishReason: event.finishReason
      });
      
      onFinish(event);
    });
    
    return result;
  }
}
```

## ğŸš€ éƒ¨ç½²å»ºè®®

1. **ç¯å¢ƒå˜é‡é…ç½®**ï¼šå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡æ§åˆ¶é»˜è®¤æç¤ºè¯é…ç½®
2. **é…ç½®çƒ­æ›´æ–°**ï¼šæ”¯æŒåœ¨ä¸é‡å¯æœåŠ¡çš„æƒ…å†µä¸‹æ›´æ–°æç¤ºè¯
3. **å¤šç§Ÿæˆ·æ”¯æŒ**ï¼šä¸åŒçš„å®¢æˆ·å¯ä»¥ä½¿ç”¨ä¸åŒçš„æç¤ºè¯é…ç½®
4. **ç¼“å­˜ä¼˜åŒ–**ï¼šå¯¹ç”Ÿæˆçš„æç¤ºè¯è¿›è¡Œç¼“å­˜ä»¥æé«˜æ€§èƒ½

è¿™ä¸ªç³»ç»Ÿæç¤ºè¯ç®¡ç†æ–¹æ¡ˆæä¾›äº†æå¤§çš„çµæ´»æ€§ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„åº”ç”¨åœºæ™¯å’Œç”¨æˆ·éœ€æ±‚åŠ¨æ€è°ƒæ•´AIåŠ©æ‰‹çš„è¡Œä¸ºå’Œé£æ ¼ï¼
